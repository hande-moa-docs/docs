# Git 워크플로우 규칙 

본 문서는 **Team hande**의 Moa Life 프로젝트에서 Git 브랜치 전략, 커밋/PR 작성 규칙, 이슈 관리 규칙을 정의합니다.

**작성자:**  

**문서 버전:** v1.0

**대상 독자:**
- **개발자(프론트엔드/백엔드)**: 브랜치 전략, 커밋/PR 규칙을 실무에 적용
- **팀 리더/리뷰어**: 코드 리뷰 및 협업 관리 기준으로 활용
- **신규 합류자**: Git 협업 규칙을 빠르게 이해하기 위한 온보딩 자료

---

## 1. 브랜치 전략 및 구조

### 브랜치 종류

| 브랜치    | 용도                            |
|--------|-------------------------------|
| `main` | 최종 결과물 (배포용 전용 브랜치, 직접 작업 금지) |
| `dev`  | 통합 개발 브랜치 (모든 기능 브랜치의 병합 대상)  |

### 브랜치 네이밍 컨벤션

- `feature/기능명` → 새 기능 개발
- `fix/버그명` → 버그 수정
- `refactor/모듈명` → 리팩토링
- `docs/문서명` → 문서 추가 또는 수정
- `hotfix/급한수정` → 배포 직전 긴급 수정 (예: main에서 분기)

예시:

- **`feature/user-profile`**: 사용자 프로필 기능 개발
- **`fix/login-password-error`**: 로그인 시 비밀번호 오류 수정
- **`refactor/user-service`**: UserService 코드 구조 개선
- **`docs/contributing-guide`**: 기여 가이드 문서 작성
- **`hotfix/critical-login-failure`**: 긴급 로그인 불가 문제 해결

- GitHub의 **기본 브랜치**는 `dev`로 설정합니다.
- 모든 기능 개발은 `feature/*` 브랜치에서 시작하고, 작업 완료 시 `dev`로 PR을 생성합니다.

### 브랜치 보호 규칙

| 브랜치    | 보호 설정              | 설명                            |
|--------|--------------------|-------------------------------|
| `main` | main-protection 적용 | 직접 커밋/삭제 금지, 오직 PR 병합만 허용     |
| `dev`  | dev-protection 적용  | PR 리뷰 승인 후에만 병합 가능 (직접 푸시 금지) |

---

## 2. 기능 개발 브랜치 전체 작업 흐름

### 1. 로컬 `dev` 브랜치 동기화 (작업 시작 전)

개발을 시작하기 전, 항상 베이스가 될 `dev` 브랜치를 원격 저장소의 최신 상태로 맞춥니다.

```bash
git fetch origin
git switch dev
git pull origin dev
```

### 2. 기능 브랜치 생성 및 이동

최신화된 `dev` 브랜치에서 새로운 기능 브랜치를 생성하고 해당 브랜치로 이동합니다.

```bash
git switch -c feature/기능명
# 예: feature/story-upload
```

### 3. 기능 개발 (작업 & 커밋)

기능을 구현하고, 의미 있는 단위로 커밋(Commit)을 만듭니다. 이 과정은 작업이 끝날 때까지 여러 번 반복될 수 있습니다.

```bash
git add .
git commit -m "feat: 스토리 업로드 기능 구현"
```

### 4. 작업 브랜치를 `dev`의 최신 상태로 업데이트하기 (PR을 생성 전)

**PR을 생성하기 직전**, 또는 `dev`에 중요한 변경사항이 생겼을 때 이 과정을 진행합니다. 이를 통해 다른 팀원의 작업 내용을 내 브랜치에 미리 반영하여, 나중에 발생할 수 있는 큰 충돌(Conflict)을
예방할 수 있습니다.

**4.1. 현재 작업 내용 임시 저장 (Stash)**

아직 커밋하지 않은 변경사항이 있다면 안전하게 임시 저장합니다.

```bash
# 추적하지 않는 파일(-u)까지 포함하여 메시지와 함께 stash 합니다.
git stash push -u -m "작업 복구 전 dev 최신화 준비"
```

**4.2. `dev` 브랜치 최신화**

`dev` 브랜치로 이동하여 원격 저장소의 최신 내용을 받아옵니다.

```bash
git switch dev
git pull origin dev
```

**4.3. 다시 기능 브랜치로 복귀하여 `dev` 변경 사항 반영하기**

작업하던 기능 브랜치로 돌아와, 최신화된 `dev`의 내용을 합칩니다. **`merge` 또는 `rebase` 중 하나를 선택합니다.**

```bash
# 1. 작업 브랜치로 돌아옵니다.
git switch feature/기능명

# 2. dev 변경사항을 반영합니다. (아래 방법 중 택 1)

# 방법 1: merge (병합 이력 보존)
git merge dev

# 방법 2: rebase (깔끔한 이력, Squash and Merge 전략과 잘 맞음)
git rebase dev
```

> 💡 **충돌(Conflict) 발생 시:** `5. 코드 리뷰 및 테스트 규칙`의 **충돌 처리 규칙**을 참고하여 해결합니다.

**4.4. 임시 저장한 작업 내용 복구**

Stash에 임시 저장했던 변경사항을 다시 불러옵니다.

```bash
git stash pop
# 여러 stash 중 특정 항목을 불러올 경우: git stash list 로 확인 후 git stash pop stash@{번호}
```

> `stash pop` 후에도 충돌이 발생할 수 있습니다. 이 경우에도 침착하게 충돌을 해결하고 커밋하면 됩니다.

### 5. 원격 저장소에 푸시 (Push)

로컬에서 기능 개발 및 `dev` 동기화까지 완료했다면, 원격 저장소에 기능 브랜치를 푸시합니다.

```bash
git push origin feature/기능명
```

> `rebase`를 사용한 경우, 원격 브랜치에 이미 같은 이름의 브랜치가 있다면 `git push origin feature/기능명 --force-with-lease` 옵션이 필요할 수 있습니다.

### 6. GitHub에서 PR 생성 (`feature/*` → `dev`)

GitHub 저장소에서 `feature/기능명` 브랜치에서 `dev` 브랜치로 향하는 Pull Request를 생성합니다. 동료에게 코드 리뷰를 요청하고 논의를 진행합니다.

### 7. 병합 완료 후 브랜치 삭제

PR이 `dev` 브랜치에 성공적으로 병합되었다면, 더 이상 필요 없어진 기능 브랜치를 로컬과 원격 저장소에서 모두 삭제합니다.

```bash
# 1. dev 브랜치로 이동하여 PR 병합 내용을 로컬에 반영합니다.
git switch dev
git pull origin dev

# 2. 로컬에서 기능 브랜치를 삭제합니다.
git branch -d feature/기능명

# 3. 원격 저장소에서 기능 브랜치를 삭제합니다.
git push origin --delete feature/기능명
```

### 💡 Tip: 집 등 다른 장소에서 작업 이어가기

회사에서 작업하던 내용을 집에서 이어가거나, 그 반대의 경우를 위한 가이드입니다. 상황은 크게 두 가지로 나뉩니다.

#### 상황 1: 이전 작업이 `dev`에 병합되었고, 새로운 작업을 시작할 때

이전 PR이 성공적으로 병합되었다면, 집 컴퓨터의 환경은 새로운 작업을 시작하기 전의 상태와 같습니다. 따라서 **위의 기능 개발 전체 흐름(1~7번)**을 처음부터 따르면 됩니다.

핵심은 최신 `dev` 브랜치에서 새로운 기능 브랜치를 만드는 것입니다.

```bash
# 1. 로컬 dev 브랜치를 최신 상태로 업데이트
git switch dev
git pull origin dev

# 2. 새로운 기능 브랜치 생성
git switch -c feature/새로운-기능명
```

#### 상황 2: 작업하던 브랜치를 그대로 이어서 작업할 때 (PR 전)

기능 개발이 끝나지 않아 PR을 올리기 전이거나, PR이 리뷰 중인 상태에서 다른 장소에서 작업을 이어가고 싶을 때입니다.

**1. 기존 컴퓨터(예: 회사)에서:**
가장 중요한 단계입니다. 로컬에만 있는 커밋이 없도록 **모든 변경사항을 원격 저장소에 푸시**합니다.

```bash
# 작업하던 브랜치의 모든 커밋을 원격에 푸시
git push origin feature/작업중인-기능명
```

**2. 새 컴퓨터(예: 집)에서:**
원격 저장소에 푸시된 브랜치를 그대로 가져와 작업을 이어갑니다.

```bash
# 1. 원격 저장소의 최신 내역을 로컬로 가져옵니다.
git fetch origin

# 2. 작업하던 원격 브랜치를 로컬로 가져와 이동합니다.
git switch feature/작업중인-기능명

# 3. 원격 브랜치의 최신 내용을 로컬 브랜치에 반영합니다.
git pull origin feature/작업중인-기능명
```

이제 기존 작업을 이어서 진행하고, 커밋 후 다시 `push`하면 됩니다.

---

## 3. 커밋 메시지 규칙

### 커밋 메시지 형식

```text
<타입>: <변경 요약> (#이슈번호)

<변경 상세 설명>
```

| 타입         | 설명                    |
|------------|-----------------------|
| `feat`     | 새로운 기능 추가             |
| `fix`      | 버그 수정                 |
| `refactor` | 리팩토링 (기능 변화 없음)       |
| `style`    | 코드 포맷팅, 세미콜론 누락 등     |
| `docs`     | 문서 수정 및 추가            |
| `chore`    | 빌드 설정, 패키지 관리 등 기타 변경 |
| `test`     | 테스트 코드 추가 및 수정        |

---

### 작성 규칙

1. **첫 줄**: 변경의 핵심을 간결하게 요약 (`<타입>: <변경 요약> (#이슈번호)`)
2. **두 번째 줄은 비움**
3. **세 번째 줄 이후**: 변경 상세 설명

    * 무엇을 변경했고, 왜 변경했는지 간단히 작성
    * 필요 시 변경된 파일/모듈, 동작 방식, 주의사항 등 추가
    * 여러 변경 사항은 불릿(`-`)으로 구분

---

GitHub·GitLab·`git log --oneline`에서는 **첫 줄만** 대표 메시지로 보입니다.

상세 설명은 PR, `git show`에서 확인 가능해서 협업 시 추적이 편합니다.

---

### 예시

```bash
feat: 여행 등록 및 관리 기능 추가 (#45)

- 여행 목록 조회 및 검색 기능 구현 (TripSearchRequestDto, TripStatusInfo, TripListItemDto 추가)
- 여행 등록/수정 페이지(trip-form.html, trip-form.js) 추가
- 여행 목록 페이지(trip-list.js) 상태/필터 기능 확장
- SecurityConfig에 /trips/**, /dashboard 접근 허용
```

---

## 4. PR(Pull Request) 작성 규칙

### 제목 형식

`[타입]: 상세 내용 (#이슈 번호)` (예: `feat: 로그인 기능 구현 (#12)`)

- feat: 새로운 기능 추가
- fix: 버그 수정
- refactor: 리팩토링 (기능 변경 없이 구조 개선)
- docs: 문서 수정
- test: 테스트 코드 추가/수정
- style: 코드 포맷팅, 세미콜론 누락 등
- chore: 빌드 업무 수정, 패키지 매니저 설정 등

### 본문

PR 생성 시 `.github/PULL_REQUEST_TEMPLATE.md`에 정의된 템플릿이 자동으로 적용됩니다. 각 항목에 맞게 내용을 기재해주세요.

※ **불필요한 항목은 삭제 가능합니다.**

> ❗ PR 작성자는 반드시 본인의 로컬에서 기능 테스트를 완료한 후 올려야 합니다.

---

## 5. 코드 리뷰 및 테스트 규칙

- **최소 리뷰 인원**: 팀원 **1인 이상에게 Approve**를 받아야 병합 가능
- **자기 PR 직접 병합 금지**: 본인이 올린 PR은 **Merge 금지**
- **기능 실행 테스트 필수**: 리뷰어는 해당 브랜치를 직접 로컬에서 실행하여 검증합니다.

### 코드 리뷰 절차

1. **브랜치 방향 확인**
   예: `feature/story-upload` → `dev`

2. **변경 코드 확인**
   GitHub의 `Files changed` 탭에서 전체 변경 사항 확인

3. **로컬 테스트**
   ```bash
   git fetch origin
   git checkout feature/브랜치명  # 리뷰할 브랜치로 이동
   # 실행 후 실제 기능 확인 (예: AI 생성 테스트, 스토리 업로드 등)
   ```

4. **피드백 작성 및 승인**
    - `LGTM!`, `수고하셨습니다` 등 코멘트 + Approve
    - 문제가 있거나 수정이 필요한 경우 `Changes requested` 선택 + 구체적 피드백

### 충돌(Conflict) 처리 규칙

- **충돌 발생 시 PR 작성자가 직접 해결**
    - 리뷰어 승인 전까지 로컬 환경에서 해결 후 `git push`로 갱신
- **해결 절차**
    1. 최신 `dev` 브랜치를 로컬로 가져오기
       ```bash
        # 1. 원격 저장소의 최신 정보를 가져옵니다.
        git fetch origin

        # 2. 내 작업 브랜치로 이동합니다.
        git checkout feature/브랜치명

        # 3. 최신 dev 브랜치의 내용을 내 브랜치로 병합합니다. (이때 충돌이 발생할 수 있음)
        git merge origin/dev
       ```
    2. 충돌 파일을 열어 수정 후 저장
    3. 수정 완료 후 커밋 & 푸시
       ```bash
       git add .
       git commit -m "Resolve merge conflict: 파일명"
       git push origin feature/브랜치명
       ```
- **주의 사항**
    - 충돌 시 무조건 자신의 코드만 살리지 말고, 상대방 변경 사항을 반영할 수 있는지 검토
    - 충돌 해결 후 반드시 **기능 재테스트** 진행

### Merge Commit 메시지 규칙

PR 병합 시 생성되는 Merge commit 메시지는 다음 규칙을 따릅니다.

#### 1. 기본 형식

```
<타입>: <변경 요약> (#PR번호)

- 주요 변경 사항 1
- 주요 변경 사항 2
- (선택) Closes #이슈번호
- (선택) Refs #이슈번호
```

#### 2. 작성 방법

이 규칙은 **PR을 병합(Merge)하는 리뷰어**가 **병합 시점**에 작성합니다.
GitHub의 'Merge pull request' 버튼을 누를 때 나타나는 **텍스트 박스를 직접 수정**하여 아래 형식에 맞춥니다.

1. **제목 줄**
    - PR 병합 시의 커밋 메시지는 **PR의 제목을 그대로 사용하는 것을 원칙**으로 합니다.
    - PR 제목은 `[타입]: 상세 내용 (#이슈번호)` 형식을 따르므로, 최종 커밋 메시지 또한 자연스럽게 이 형식을 따르게 됩니다.

2. **본문**
    - PR 본문의 `작업 내용 요약`에서 핵심 변경 사항만 bullet 형식으로 옮깁니다.

3. **이슈 참조**
    - **`Closes #이슈번호`**: 이 PR이 해당 이슈를 **완전히 해결**했을 때 사용합니다. PR이 병합되면 해당 이슈는 **자동으로 닫힙니다.**
    - **`Refs #이슈번호`**: 이 PR이 해당 이슈와 **관련은 있지만, 완전히 해결하지는 않을 때** 사용합니다. (예: 일부 기능만 구현) 이슈는 닫히지 않고 연결만 됩니다.


---

## 6. 이슈 관리 규칙

### 이슈 생성 원칙

- 모든 작업은 **이슈 먼저 생성** → **자신을 Assignee로 지정** 후 진행
- 커밋과 PR에는 해당 이슈 번호를 반드시 태그합니다

### 본문

이슈 생성 시 `.github/ISSUE_TEMPLATE/`에 정의된 템플릿을 선택하여 작성할 수 있습니다. 목적에 맞는 템플릿을 사용하여 필요한 정보를 기재해주세요.

※ **불필요한 항목은 삭제 가능합니다.**

> **참고**: `---`로 감싸인 상단 영역은 GitHub가 이슈의 제목, 라벨 등을 자동으로 설정하기 위해 사용하는 부분입니다.

---