# 반띵 - 대형마트 소분 모임 서비스 비즈니스 로직 명세서

---

## 문서 정보
- **문서명**: 반띵 서비스 비즈니스 로직 명세서
- **버전**: v1.1.0
- **작성일**: 2025.09.09
- **작성자**: 박현수
- **최종 수정일**: 2025.09.09

---

## 1. 개요

### 1.1 목적
본 문서는 반띵 서비스의 핵심 비즈니스 로직과 규칙을 정의하여 개발팀이 일관된 서비스 로직을 구현할 수 있도록 가이드를 제공한다.

### 1.2 서비스 정의
지도 기반의 대용량 상품 소분 커뮤니티 플랫폼으로, 코스트코, 트레이더스 등 대형마트에서 대용량 상품을 소분하여 구매하는 모임을 연결하는 서비스이다.

### 1.3 적용 범위
- 사용자 관리 및 인증 시스템
- 모임 생명주기 관리
- 지도 기반 검색 및 탐색
- 댓글 및 커뮤니케이션 시스템
- 후기 및 신뢰도 평가 시스템
- AI 챗봇 지원 시스템

---

## 2. 사용자 관리 및 인증 로직

### 2.1 회원가입 및 로그인 로직

#### 2.1.1 카카오톡 SSO 인증 프로세스
1. 사용자가 카카오톡 로그인 버튼 클릭
2. 카카오 OAuth 2.0 인증 페이지로 리다이렉션
3. 사용자 동의 후 인증 코드 발급
4. 서버에서 인증 코드로 액세스 토큰 요청
5. 카카오 API를 통해 사용자 기본 정보 조회
6. 기존 회원 여부 확인
    - 신규 사용자: 추가 정보 입력 단계로 이동
    - 기존 사용자: 즉시 로그인 처리
7. JWT 토큰 발급 및 로컬스토리지에 저장

#### 2.1.2 신규 회원 정보 설정
- **닉네임 설정**: 2자 이상 10자 이하, 한글/영문/숫자만 허용
- **프로필 사진**: 카카오 프로필 사진 기본 사용, 변경 가능
- **자기소개**: 선택 사항, 최대 100자

### 2.2 권한 관리 시스템

#### 2.2.1 사용자 권한 레벨
- **비회원(GUEST)**: 모임 목록 조회만 가능
- **일반회원(USER)**: 기본 기능 이용 가능
- **호스트(HOST)**: 모임 생성 및 관리 권한 (모임별 부여)
- **관리자(ADMIN)**: 전체 시스템 관리 권한

#### 2.2.2 기능별 접근 제어
- **모임 상세 조회**: 로그인한 회원만 가능
- **모임 신청**: 일반회원 이상, 본인이 생성한 모임 제외
- **댓글 작성**: 해당 모임의 호스트 또는 승인된 참여자만 가능
- **후기 작성**: 완료된 모임의 참여자만, 본인 제외 대상에게만 가능

---

## 3. 모임 관리 로직

### 3.1 모임 생성 및 수정 로직

#### 3.1.1 모임 생성 유효성 검증
1. **필수 정보 검증**
    - 제목: 5자 이상 50자 이하
    - 상품명: 2자 이상 30자 이하
    - 장소: 지도 API 연동을 통한 유효한 주소
    - 인원: 최소 2명, 최대 5명

2. **비즈니스 규칙 검증**
    - 동일 사용자의 동일 매장, 동일 시간대 중복 모임 생성 방지
    - 사용자당 동시 운영 가능 모임 수 제한 (최대 5개)
    - 카테고리 필수 선택 (식품, 생활용품, 기타)

3. **데이터 무결성 검증**
    - 이미지 파일 형식 및 크기 제한 (JPG, PNG, 최대 5MB)
    - HTML 태그 및 특수문자 이스케이프 처리

#### 3.1.2 모임 수정 로직
- **수정 권한**: 해당 모임의 호스트만 가능
- **수정 제한**: 모집중 상태에서만 수정 가능
- **참여자 보호**: 인원 감소 시 이미 승인된 참여자 수보다 적게 설정 불가
- **변경 알림**: 주요 정보 변경 시 참여자들에게 자동 알림

### 3.2 모임 상태 관리 로직

#### 3.2.1 모임 상태 정의 및 전환
1. **모집중(RECRUITING)**
    - 초기 생성 상태
    - 참여 신청 접수 가능
    - 호스트가 신청자 승인/거절 가능

2. **모집마감(FULL)**
    - 정원 달성 또는 호스트 수동 마감
    - 마감 취소 가능

3. **진행중(ONGOING)**
    - 모임 시작 시간 도달 시 자동 전환
    - 출석 확인 기능 활성화

4. **완료(COMPLETED)**
    - 호스트가 수동으로 완료 처리
    - 피드백 기능 활성화
    - 모든 관리 기능 제한

5. **취소(CANCELLED)**
    - 호스트가 수동 취소 처리
    - 조회만 가능한 읽기 전용 상태

#### 3.2.2 자동 상태 전환 규칙
- **모집중 → 진행중**: 모임 시작 시간 도달 시 배치 처리로 자동 전환
- **진행중 → 완료**: 모임 종료 시간 2시간 후 자동 완료 처리 (선택적)
- **상태 롤백**: 시스템 오류 시 이전 상태로 롤백 가능

### 3.3 참여자 관리 로직

#### 3.3.1 참여 신청 검증 로직
1. **기본 자격 요건**
    - 로그인한 회원만 신청 가능
    - 모집중 상태의 모임만 신청 가능
    - 본인이 생성한 모임 신청 불가

2. **정원 및 시간 검증**
    - 현재 참여자 수가 최대 인원 미만이어야 함
    - 신청 마감 시간 확인 (모임 시작 1시간 전)

3. **신뢰도 기반 제한**
    - 신뢰도 점수 0점 미만 사용자 참여 금지

#### 3.3.2 호스트 승인 처리 로직
1. **승인 프로세스**
    - 신청자 프로필 및 신뢰도 점수 확인 가능
    - 승인 시 참여자 목록에 추가 및 현재 인원수 증가
    - 정원 달성 시 자동으로 모집마감 상태 전환
    - 승인된 참여자에게 실시간 알림 발송

2. **거절 프로세스**
    - 거절 이후 재신청 가능

3. **참여자 거절 로직**
    - 호스트가 승인된 참여자를 거절 가능
    - 논리적 삭제로 처리하여 이력 보존
    - 제거된 참여자에게 알림 및 사유 전달

---

## 4. 지도 기반 검색 및 탐색 로직

### 4.1 지도 연동 로직

#### 4.1.1 매장 정보 관리
- **매장 등록**: 관리자가 대형마트 지점 정보를 사전 등록
- **매장 분류**: 코스트코, 이마트 트레이더스 등 브랜드별 분류

#### 4.1.2 모임 위치 기반 검색 로직
1. **지역 선택 검색**
    - 시/도, 시/군/구 지역 단위 선택
    - 선택한 지역 내 모든 매장 및 모임 표시

### 4.2 모임 필터링 및 정렬 로직

#### 4.2.1 필터링 옵션
- **위치 필터**: 특정 매장 또는 지역 선택
- **상태 필터**: 모집중, 모집마감, 진행중


#### 4.2.2 정렬 옵션
- **최신순**: 모임 생성 시간 기준 최신 순

---

## 5. 댓글 시스템 로직

### 5.1 댓글 접근 권한 관리

#### 5.1.1 읽기 권한
- **전체 공개**: 해당 모임의 호스트 및 승인된 참여자만 조회 가능
- **비참여자 제한**: 신청 대기중인 사용자 및 일반 사용자는 댓글, 모임리스트 조회 불가
- **상태별 접근**: 모집중부터 마감까지 모든 상태에서 조회 가능 (종료 불가능)

#### 5.1.2 작성 권한
- **작성 자격**: 호스트 또는 승인된 참여자만 작성 가능
- **실시간 검증**: 댓글 작성 시 현재 참여 상태 재확인
- **상태 제한**: 취소된 모임에서는 댓글 작성 불가

### 5.2 댓글 관리 로직

#### 5.2.1 댓글 생성 
- **길이 제한**: 최대 500자까지 작성 가능


#### 5.2.3 실시간 업데이트
- **동시성 제어**: 여러 사용자의 동시 댓글 작성 시 순서 보장

---

## 6. 후기 및 신뢰도 평가 시스템

### 6.1 후기 작성 로직

#### 6.1.1 후기 작성 조건
1. **모임 상태 조건**: 완료(COMPLETED) 상태인 모임만 대상
2. **참여자 자격**: 실제로 모임에 참여한 사용자만 작성 가능
3. **대상 제한**: 본인을 제외한 다른 참여자들에게만 피드백 가능
4. **중복 방지**: 동일 모임에서 동일 대상에게 중복 피드백 불가

#### 6.1.2 후기 평가 방식
- **평가 항목**: 업, 다운 버튼 클릭 시 피드백 반영

### 6.2 신뢰도 점수 계산 로직

#### 6.2.1 점수 산정 규칙
1. **기본 활동 점수**
    - 모임 생성: +2점
    - 모임 참여 완료: +1점

2. **후기 기반 점수**
   - 피드백(업): +3
   - 피드백(다운): -3

3. **패널티 점수**
    - 노쇼: -20점

#### 6.2.2 신뢰도 등급 시스템
1. **등급 분류**
    - 좋음(500점 이상): 좋음 배지, 우선 승인 혜택
    - 기본(100-299점): 기본 배지, 제한 없음
    - 경고(0-99점): 경고 배지, 참여 제한



---

## 7. AI 챗봇 지원 시스템

### 7.1 AI 챗봇 기능 정의

#### 7.1.1 지원 범위

1. **소분 관련 정보 제공**
    - 상품별 적정 소분 제품 추천
    - 소분 방법 및 보관법 안내


#### 7.1.2 대화 처리 로직
1. **의도 파악**: 사용자 질문의 카테고리 분류
2. **한계 인식**: 답변 불가능한 질문에 대한 적절한 안내

### 7.2 챗봇 연동 로직

#### 7.2.1 실시간 정보 연동
- **모임 현황**: 실시간 모임 상태 및 참여 가능 여부 확인
- **참여자 정보**: 사용자의 참여 이력 및 신뢰도 등급 반영 

---


## 8. 변경 이력

| 버전     | 날짜         | 변경 내용                          | 작성자 |
|--------|------------|--------------------------------|-----|
| v1.0.0 | 2025.09.09 | 초기 비즈니스 로직 명세서 작성          | 박현수 |


---